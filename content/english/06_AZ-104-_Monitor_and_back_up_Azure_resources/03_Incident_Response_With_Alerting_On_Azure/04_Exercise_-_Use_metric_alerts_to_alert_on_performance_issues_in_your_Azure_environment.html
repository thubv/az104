<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exercise - Use metric alerts to alert on performance issues in your Azure environment - Training | Microsoft Learn</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            max-width: 900px;
            margin: 0 auto;
            padding: 30px 20px;
            color: #333;
            background-color: #fff;
        }
        
        h1, h2, h3, h4, h5, h6 {
            color: #0078d4;
            margin-top: 2em;
            margin-bottom: 1em;
            font-weight: 600;
        }
        
        h1 { 
            border-bottom: 3px solid #0078d4; 
            padding-bottom: 15px; 
            font-size: 2.2em;
            margin-bottom: 1.5em;
        }
        
        h2 { 
            font-size: 1.6em; 
            border-left: 4px solid #0078d4;
            padding-left: 15px;
        }
        
        h3 { font-size: 1.3em; }
        h4 { font-size: 1.1em; }
        
        p {
            margin: 16px 0;
            text-align: justify;
            line-height: 1.7;
        }
        
        ul, ol {
            margin: 20px 0;
            padding-left: 30px;
        }
        
        li {
            margin: 10px 0;
            line-height: 1.6;
        }
        
        code {
            background-color: #f6f8fa;
            padding: 3px 8px;
            border-radius: 4px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.9em;
            color: #d73a49;
        }
        
        pre {
            background-color: #f6f8fa;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            border-left: 4px solid #0078d4;
            margin: 20px 0;
        }
        
        pre code {
            background: none;
            padding: 0;
            color: #333;
        }
        
        blockquote {
            border-left: 4px solid #0078d4;
            padding: 20px;
            margin: 20px 0;
            background-color: #f8f9fa;
            border-radius: 4px;
            font-style: italic;
        }
        
        .source-info {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            border-left: 5px solid #2196f3;
            font-size: 0.9em;
        }
        
        .source-info h2 {
            margin-top: 0;
            color: #1976d2;
            font-size: 1.2em;
        }
        
        .translation-placeholder {
            background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
            padding: 20px;
            border-radius: 8px;
            margin-top: 40px;
            border-left: 5px solid #ff9800;
        }
        
        .translation-placeholder h2 {
            margin-top: 0;
            color: #f57c00;
            font-size: 1.2em;
        }
        
        img { 
            max-width: 100%; 
            height: auto; 
            margin: 25px 0;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        table { 
            border-collapse: collapse; 
            width: 100%; 
            margin: 25px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        th, td { 
            border: 1px solid #ddd; 
            padding: 15px; 
            text-align: left; 
        }
        
        th { 
            background-color: #f5f5f5; 
            font-weight: bold;
            color: #0078d4;
        }
        
        .highlight {
            background-color: #fff3cd;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #ffc107;
            margin: 20px 0;
        }
        
        strong {
            color: #0078d4;
            font-weight: 600;
        }
        
        a {
            color: #0078d4;
            text-decoration: none;
        }
        
        a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="source-info">
        <h2>ðŸ“š Course Information</h2>
        <p><strong>Unit:</strong> Exercise - Use metric alerts to alert on performance issues in your Azure environment</p>
        <p><strong>Source:</strong> <a href="https://learn.microsoft.com/en-us/training/modules/incident-response-with-alerting-on-azure/4-exercise-metric-alerts/?ns-enrollment-type=learningpath&ns-enrollment-id=learn.az-104-monitor-backup-resources" target="_blank">Microsoft Learn</a></p>
        <p><strong>Course:</strong> AZ-104: Microsoft Azure Administrator</p>
    </div>
    
    <div class="main-content">
        <div aria-hidden="false" id="module-unit-content">
 <p>
  The shipping company you work for wants to avoid any future issues with updates to its applications on the Azure platform. To improve the alert capabilities in Azure, you made the choice to use Azure metric alerts.
 </p>
 <p>
  In this exercise, you create a Linux virtual machine (VM). This VM runs an app that runs the CPU at 100 percent utilization. You create monitoring rules in the Azure portal and in the Azure CLI to alert you about high CPU usage.
 </p>
 <h2 id="create-the-vm">
  Create the VM
 </h2>
 <p>
  This VM runs a specific configuration that stresses the CPU and generates the metric monitoring data needed to trigger an alert.
 </p>
 <ol>
  <li>
   <p>
    Start by creating the configuration script. To create the
    <code>
     cloud-init.txt
    </code>
    file with the configuration for the VM, run the following command in Azure Cloud Shell:
   </p>
   <pre class="has-inner-focus"><code class="lang-bash" data-author-content="cat &lt;&lt;EOF &gt; cloud-init.txt
#cloud-config
package_upgrade: true
packages:
- stress
runcmd:
- sudo stress --cpu 1
EOF
"><span>cat &lt;&lt;EOF &gt; cloud-init.txt
<span class="hljs-comment">#cloud-config</span>
package_upgrade: <span class="hljs-literal">true</span>
packages:
- stress
runcmd:
- sudo stress --cpu 1
EOF
</span></code></pre>
  </li>
  <li>
   <p>
    To set up an Ubuntu Linux VM, run the following
    <code>
     az vm create
    </code>
    command. This command uses the
    <code>
     cloud-init.txt
    </code>
    file that you created in the previous step to configure the newly created Ubuntu Linux VM.
   </p>
   <pre class="has-inner-focus"><code class="lang-azurecli" data-author-content='az vm create \
    --resource-group "&lt;rgn&gt;[sandbox resource group name]&lt;/rgn&gt;" \
    --name vm1 \
    --location eastUS \
    --image Ubuntu2204 \
    --custom-data cloud-init.txt \
    --generate-ssh-keys
'><span><span class="hljs-keyword">az vm create </span>\
    <span class="hljs-parameter">--resource-group</span> <span class="hljs-string">"[sandbox resource group name]"</span> \
    <span class="hljs-parameter">--name</span> vm1 \
    <span class="hljs-parameter">--location</span> eastUS \
    <span class="hljs-parameter">--image</span> Ubuntu2204 \
    <span class="hljs-parameter">--custom-data</span> cloud<span class="hljs-parameter">-init</span>.txt \
    <span class="hljs-parameter">--generate-ssh-keys</span>
</span></code></pre>
  </li>
 </ol>
 <h2 id="create-the-metric-alert-using-the-azure-portal">
  Create the metric alert using the Azure portal
 </h2>
 <div class="alert is-info">
  <p class="alert-title">
   Note
  </p>
  <p>
   Wait until the VM is successfully created before proceeding with the exercise. The VM creation process is complete when you get the completed JSON output in the Azure Cloud Shell window.
  </p>
 </div>
 <p>
  You can use either the Azure portal or the CLI to create a metric alert. In this exercise, we cover both, starting with the Azure portal.
 </p>
 <ol>
  <li>
   <p>
    Sign in to the
    <a class="has-external-link-indicator" data-linktype="external" href="https://portal.azure.com/learn.docs.microsoft.com" target="az-portal">
     Azure portal
    </a>
    using the same account that you used to activate the sandbox.
   </p>
  </li>
  <li>
   <p>
    On the Azure portal menu, search for and select
    <strong>
     Monitor
    </strong>
    . On the
    <strong>
     Monitor Overview
    </strong>
    page, select
    <strong>
     Alerts
    </strong>
    .
   </p>
  </li>
  <li>
   <p>
    Open the
    <strong>
     + Create
    </strong>
    menu, and select
    <strong>
     Alert rule
    </strong>
   </p>
  </li>
  <li>
   <p>
    On the
    <strong>
     Select a resource
    </strong>
    pane, set the scope for your alert rule. You can filter by subscription, resource type, or resource location.
   </p>
  </li>
  <li>
   <p>
    In the
    <strong>
     Resource types
    </strong>
    drop-down, start to type "virtual machines", and select
    <strong>
     Virtual machines
    </strong>
    .
   </p>
  </li>
  <li>
   <p>
    Check the box next to
    <strong>
     vm1
    </strong>
    , then select
    <strong>
     Apply
    </strong>
    at the bottom of the pane.
   </p>
  </li>
  <li>
   <p>
    Select
    <strong>
     Next:Condition
    </strong>
    at the bottom of the page.
   </p>
  </li>
  <li>
   <p>
    In the
    <strong>
     Signal name
    </strong>
    drop-down, select
    <strong>
     Percentage CPU
    </strong>
    .
   </p>
  </li>
  <li>
   <p>
    In the
    <strong>
     Alert logic
    </strong>
    section, enter (or confirm) the following values for each setting.
   </p>
   <div class="has-inner-focus">
    <table aria-label="Table 1" class="table">
     <thead>
      <tr>
       <th>
        Setting
       </th>
       <th>
        Value
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        <strong>
         Alert logic
        </strong>
       </td>
      </tr>
      <tr>
       <td>
        Threshold
       </td>
       <td>
        Static
       </td>
      </tr>
      <tr>
       <td>
        Aggregation type
       </td>
       <td>
        Maximum
       </td>
      </tr>
      <tr>
       <td>
        Operator
       </td>
       <td>
        Greater than
       </td>
      </tr>
      <tr>
       <td>
        Threshold value
       </td>
       <td>
        90
       </td>
      </tr>
      <tr>
       <td>
        <strong>
         When to evaluate
        </strong>
       </td>
      </tr>
      <tr>
       <td>
        Check every
       </td>
       <td>
        1 minute
       </td>
      </tr>
      <tr>
       <td>
        Lookback period
       </td>
       <td>
        1 minute
       </td>
      </tr>
     </tbody>
    </table>
   </div>
  </li>
  <li>
   <p>
    Select the
    <strong>
     Details
    </strong>
    tab at the top of the page. In the
    <strong>
     Alert rule details
    </strong>
    section, enter the following values for each setting.
   </p>
   <div class="has-inner-focus">
    <table aria-label="Table 2" class="table">
     <thead>
      <tr>
       <th>
        Setting
       </th>
       <th>
        Value
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        Severity
       </td>
       <td>
        2 - Warning
       </td>
      </tr>
      <tr>
       <td>
        Alert rule name
       </td>
       <td>
        Cpu90PercentAlert
       </td>
      </tr>
      <tr>
       <td>
        Description
       </td>
       <td>
        Virtual machine is running at or greater than 90% CPU utilization
       </td>
      </tr>
     </tbody>
    </table>
   </div>
  </li>
  <li>
   <p>
    Expand the
    <strong>
     Advanced options
    </strong>
    section and confirm the following values for each setting.
   </p>
   <div class="has-inner-focus">
    <table aria-label="Table 3" class="table">
     <thead>
      <tr>
       <th>
        Setting
       </th>
       <th>
        Value
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td>
        Enable upon creation
       </td>
       <td>
        Yes (checked)
       </td>
      </tr>
      <tr>
       <td>
        Automatically resolve alerts
       </td>
       <td>
        Yes (checked)
       </td>
      </tr>
     </tbody>
    </table>
   </div>
  </li>
  <li>
   <p>
    Select
    <strong>
     Review + create
    </strong>
    to validate your input, and then select
    <strong>
     Create
    </strong>
    .
   </p>
  </li>
 </ol>
 <p>
  You successfully created a metric alert rule that triggers an alert when the CPU percentage on the VM exceeds 90 percent. The rule checks every minute and reviews one minute of data. It can take up to 10 minutes for a metric alert rule to become active.
 </p>
 <h2 id="create-the-metric-alert-through-the-cli">
  Create the metric alert through the CLI
 </h2>
 <p>
  You can also set up metric alerts by using the CLI. This process can be quicker than using the portal, especially if you're planning to set up more than one alert.
 </p>
 <p>
  Let's create a new metric alert similar to the one you set up in the Azure portal.
 </p>
 <ol>
  <li>
   <p>
    Run the following command in Cloud Shell to obtain the resource ID of the virtual machine you previously created:
   </p>
   <pre aria-label="Horizontally scrollable code" class="has-inner-focus" role="group" tabindex="0"><code class="lang-bash" data-author-content='VMID=$(az vm show \
        --resource-group "&lt;rgn&gt;[sandbox resource group name]&lt;/rgn&gt;" \
        --name vm1 \
        --query id \
        --output tsv)
'><span>VMID=$(az vm show \
        --resource-group <span class="hljs-string">"[sandbox resource group name]"</span> \
        --name vm1 \
        --query id \
        --output tsv)
</span></code></pre>
  </li>
  <li>
   <p>
    Run the following command to create a new metric alert. The alert is triggered when the VM CPU is greater than 80 percent.
   </p>
   <pre aria-label="Horizontally scrollable code" class="has-inner-focus" role="group" tabindex="0"><code class="lang-azurecli" data-author-content='az monitor metrics alert create \
    -n "Cpu80PercentAlert" \
    --resource-group "&lt;rgn&gt;[sandbox resource group name]&lt;/rgn&gt;" \
    --scopes $VMID \
    --condition "max percentage CPU &gt; 80" \
    --description "Virtual machine is running at or greater than 80% CPU utilization" \
    --evaluation-frequency 1m \
    --window-size 1m \
    --severity 3
'><span><span class="hljs-keyword">az monitor metrics alert create </span>\
    <span class="hljs-parameter">-n</span> <span class="hljs-string">"Cpu80PercentAlert"</span> \
    <span class="hljs-parameter">--resource-group</span> <span class="hljs-string">"[sandbox resource group name]"</span> \
    <span class="hljs-parameter">--scopes</span> <span class="hljs-variable">$VMID</span> \
    <span class="hljs-parameter">--condition</span> <span class="hljs-string">"max percentage CPU &gt; 80"</span> \
    <span class="hljs-parameter">--description</span> <span class="hljs-string">"Virtual machine is running at or greater than 80% CPU utilization"</span> \
    <span class="hljs-parameter">--evaluation-frequency</span> <span class="hljs-number">1</span>m \
    <span class="hljs-parameter">--window-size</span> <span class="hljs-number">1</span>m \
    <span class="hljs-parameter">--severity</span> <span class="hljs-number">3</span>
</span></code></pre>
  </li>
 </ol>
 <h2 id="view-your-metric-alerts-in-azure-monitor">
  View your metric alerts in Azure Monitor
 </h2>
 <p>
  In this exercise, you set up an Ubuntu VM and configured it to stress test the CPU. You also created a metric rule to detect when the maximum CPU percentage exceeds 80 percent and 90 percent.
 </p>
 <div class="alert is-info">
  <p class="alert-title">
   Note
  </p>
  <p>
   It might take 10 minutes before you see the alerts show up in the Azure portal.
  </p>
 </div>
 <ol>
  <li>
   <p>
    Return to the
    <a class="has-external-link-indicator" data-linktype="external" href="https://portal.azure.com/learn.docs.microsoft.com" target="az-portal">
     Azure portal
    </a>
    .
   </p>
  </li>
  <li>
   <p>
    On the Azure portal menu, select
    <strong>
     Monitor
    </strong>
    , and then select
    <strong>
     Alerts
    </strong>
    in the left menu pane.
   </p>
   <p>
    This step presents the Alert summary pane, where you can see the count of the number of alerts. If you don't see your alerts listed, wait a few minutes and select
    <strong>
     Refresh
    </strong>
    .
   </p>
  </li>
  <li>
   <p>
    You configured your metric alerts with severities of 2 and 3. Select one of the alerts to view the severity level.
   </p>
  </li>
  <li>
   <p>
    Select one of the alerts to show the alert details.
   </p>
  </li>
 </ol>
</div>

    </div>
    
    <div class="translation-placeholder">
        <h2>ðŸ‡»ðŸ‡³ Vietnamese Translation</h2>
        <p><em>Báº£n dá»‹ch tiáº¿ng Viá»‡t sáº½ Ä‘Æ°á»£c thÃªm vÃ o Ä‘Ã¢y...</em></p>
        <p><em>Translation will be added here...</em></p>
    </div>
</body>
</html>
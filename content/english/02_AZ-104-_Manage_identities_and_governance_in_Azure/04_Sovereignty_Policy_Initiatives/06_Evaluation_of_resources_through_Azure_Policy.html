<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Evaluation of resources through Azure Policy - Training | Microsoft Learn</title>
<style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            max-width: 900px;
            margin: 0 auto;
            padding: 30px 20px;
            color: #333;
            background-color: #fff;
        }
        
        h1, h2, h3, h4, h5, h6 {
            color: #0078d4;
            margin-top: 2em;
            margin-bottom: 1em;
            font-weight: 600;
        }
        
        h1 { 
            border-bottom: 3px solid #0078d4; 
            padding-bottom: 15px; 
            font-size: 2.2em;
            margin-bottom: 1.5em;
        }
        
        h2 { 
            font-size: 1.6em; 
            border-left: 4px solid #0078d4;
            padding-left: 15px;
        }
        
        h3 { font-size: 1.3em; }
        h4 { font-size: 1.1em; }
        
        p {
            margin: 16px 0;
            text-align: justify;
            line-height: 1.7;
        }
        
        ul, ol {
            margin: 20px 0;
            padding-left: 30px;
        }
        
        li {
            margin: 10px 0;
            line-height: 1.6;
        }
        
        code {
            background-color: #f6f8fa;
            padding: 3px 8px;
            border-radius: 4px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.9em;
            color: #d73a49;
        }
        
        pre {
            background-color: #f6f8fa;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            border-left: 4px solid #0078d4;
            margin: 20px 0;
        }
        
        pre code {
            background: none;
            padding: 0;
            color: #333;
        }
        
        blockquote {
            border-left: 4px solid #0078d4;
            padding: 20px;
            margin: 20px 0;
            background-color: #f8f9fa;
            border-radius: 4px;
            font-style: italic;
        }
        
        .source-info {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            border-left: 5px solid #2196f3;
            font-size: 0.9em;
        }
        
        .source-info h2 {
            margin-top: 0;
            color: #1976d2;
            font-size: 1.2em;
        }
        
        .translation-placeholder {
            background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
            padding: 20px;
            border-radius: 8px;
            margin-top: 40px;
            border-left: 5px solid #ff9800;
        }
        
        .translation-placeholder h2 {
            margin-top: 0;
            color: #f57c00;
            font-size: 1.2em;
        }
        
        img { 
            max-width: 100%; 
            height: auto; 
            margin: 25px 0;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        table { 
            border-collapse: collapse; 
            width: 100%; 
            margin: 25px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        th, td { 
            border: 1px solid #ddd; 
            padding: 15px; 
            text-align: left; 
        }
        
        th { 
            background-color: #f5f5f5; 
            font-weight: bold;
            color: #0078d4;
        }
        
        .highlight {
            background-color: #fff3cd;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #ffc107;
            margin: 20px 0;
        }
        
        strong {
            color: #0078d4;
            font-weight: 600;
        }
        
        a {
            color: #0078d4;
            text-decoration: none;
        }
        
        a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
<div class="source-info">
<h2>ðŸ“š Course Information</h2>
<p><strong>Unit:</strong> Evaluation of resources through Azure Policy</p>
<p><strong>Source:</strong> <a href="https://learn.microsoft.com/en-us/training/modules/sovereignty-policy-initiatives/azure-policies-evaluation-resources/?ns-enrollment-type=learningpath&amp;ns-enrollment-id=learn.az-104-manage-identities-governance" target="_blank">https://learn.microsoft.com/en-us/training/modules/sovereignty-policy-initiatives/azure-policies-evaluation-resources/?ns-enrollment-type=learningpath&amp;ns-enrollment-id=learn.az-104-manage-identities-governance</a></p>
<p><strong>Course:</strong> AZ-104: Microsoft Azure Administrator</p>
</div>
<div class="main-content">
<div aria-hidden="false" id="module-unit-content">
<p>
  A significant benefit of Azure Policy is the insight and controls that it provides over resources in a subscription or management group of subscriptions. This control can be used to prevent resources from being created in the wrong location, enforce common and consistent tag usage, or audit existing resources for appropriate configurations and settings. Before you review compliance data and react to it, you need to understand the evaluation triggers, timings, and the resource compliance states.
 </p>
<h2 id="evaluation-triggers">
  Evaluation triggers
 </h2>
<p>
  Evaluations of assigned policies and initiatives happen as the result of various events:
 </p>
<ul>
<li>
   A policy or initiative is newly assigned to a scope
  </li>
<li>
   A policy or initiative already assigned to a scope is updated
  </li>
<li>
   A resource is deployed to or updated in a scope with an assignment through Azure Resource Manager, REST API, or a supported SDK
  </li>
<li>
   A subscription (resource type Microsoft.Resources/subscriptions) is created or moved in a management group hierarchy with an assigned policy definition that targets the subscription resource type
  </li>
<li>
   A policy exemption is created, updated, or deleted
  </li>
<li>
   Standard compliance evaluation cycle
  </li>
<li>
   The machine configuration resource provider is updated with compliance details by a managed resource
  </li>
<li>
   On-demand scan
  </li>
</ul>
<p>
  For more information, see
  <a data-linktype="absolute-path" href="/en-us/azure/governance/policy/how-to/get-compliance-data#evaluation-triggers">
   Evaluation triggers
  </a>
  .
 </p>
<h2 id="evaluation-timing">
  Evaluation timing
 </h2>
<p>
  When you're working with policy assignments in Azure, you need to understand the behavior and timing of compliance scans, especially in Brownfield scenarios, where new policies are applied to existing resources. Compliance scans through Azure policies are triggered by various methods:
 </p>
<ul>
<li>
<strong>
    Automatic full scan
   </strong>
   - A full compliance scan is triggered automatically every 24 hours.
  </li>
<li>
<strong>
    Manual scan for Brownfield scenarios
   </strong>
   - In cases where a new policy is applied to existing resources (Brownfield scenarios), you can manually trigger a compliance scan by running
   <em>
    az policy state trigger-scan
   </em>
   .
  </li>
</ul>
<p>
  When you assign a new policy, a delay can occur in the policy taking effect, which can be up to 30 minutes. The Azure Resource Manager cache holds session data, and it can take time for the policy to propagate in the same session. To bypass the caching delay, you can sign out and sign back in to refresh the Azure Resource Manager cache, which ensures that the new policy is applied immediately to the defined scope.
 </p>
<p>
  After the scan starts, several factors influence how long it takes for a compliance scan to complete:
 </p>
<ul>
<li>
<strong>
    Policy definitions
   </strong>
   - The size and complexity of the policy definitions can increase scan time.
  </li>
<li>
<strong>
    Number of policies
   </strong>
   - The more policies applied, the longer the scan might take.
  </li>
<li>
<strong>
    Scope size
   </strong>
   - The size of the resource scope assigned to the policy also plays a role.
  </li>
<li>
<strong>
    System load
   </strong>
   - Compliance scans are a low-priority operation, meaning that if the system is busy with more critical tasks, the scan might take longer. The system prioritizes interactive and high-importance operations, so scans might take several minutes, or tens of minutes, even in smaller environments.
  </li>
<li>
<strong>
    Synchronous scan (Low-Priority Execution)
   </strong>
   - Because compliance scans are synchronous and assigned a low priority in Azure's system, they're delayed if the system is busy. This scan can significantly extend the time it takes for the scan to complete, even for smaller scopes or policies.
  </li>
</ul>
<p>
  This understanding of the compliance scan process and potential delays allows you to better manage the application and avoid unnecessary waiting, especially in environments with complex or extensive policy definitions.
 </p>
<h2 id="resource-compliance-states">
  Resource compliance states
 </h2>
<p>
  When initiative or policy definitions are assigned, Azure Policy determines which resources are applicable. Then, it evaluates those resources that aren't excluded or exempted. Evaluation provides one of the compliance states to each resource based on conditions in the policy rule and each resource's adherence to those requirements.
 </p>
<ul>
<li>
<strong>
    Non-compliant
   </strong>
</li>
<li>
<strong>
    Compliant
   </strong>
</li>
<li>
<strong>
    Error
   </strong>
   (for template or evaluation error)
  </li>
<li>
<strong>
    Conflicting
   </strong>
   (two or more policy assignments in the same scope with contradicting rules, such as two policies appending the same tag with different values)
  </li>
<li>
<strong>
    Protected
   </strong>
   (resource covered under an assignment with a
   <em>
    denyAction
   </em>
   effect)
  </li>
<li>
<strong>
    Exempted Unknown
   </strong>
   (default state for definitions with a
   <em>
    manual
   </em>
   effect)
  </li>
</ul>
<p>
  When multiple resources or policies have varying compliance states, the overall compliance state is assessed individually for each resource and for each policy assignment. Azure Policy ranks each compliance state so that one wins over another in this situation. The rank order of the states is as given in the previous list of compliance states.
 </p>
<p>
  The compliance percentage is determined by dividing
  <strong>
   Compliant
  </strong>
  ,
  <strong>
   Exempt
  </strong>
  , and
  <strong>
   Unknown
  </strong>
  resources by total resources. Total resources include resources with
  <strong>
   Compliant
  </strong>
  ,
  <strong>
   Non-compliant
  </strong>
  ,
  <strong>
   Unknown
  </strong>
  ,
  <strong>
   Exempt
  </strong>
  ,
  <strong>
   Conflicting
  </strong>
  , and
  <strong>
   Error
  </strong>
  states.
 </p>
<p>
  For more information on when the policies return these states for any particular resource, see
  <a data-linktype="absolute-path" href="/en-us/azure/governance/policy/concepts/compliance-states">
   Azure Policy compliance states
  </a>
  .
 </p>
<h2 id="enforcement-mode">
  Enforcement Mode
 </h2>
<p>
<em>
   enforcementMode
  </em>
  is a property of a policy assignment that lets you deactivate the enforcement of certain policy effects. This mode allows you to test the policy's outcome on existing resources without initiating the policy effect or triggering entries in the
  <a data-linktype="absolute-path" href="/en-us/azure/azure-monitor/essentials/platform-logs-overview">
   Azure Activity log
  </a>
  . The
  <em>
   enforcementMode
  </em>
  can be changed to Enabled after the policy is thoroughly tested.
 </p>
<p>
  This scenario is commonly referred to as
  <em>
   What If
  </em>
  and aligns to safe deployment practices. The
  <em>
   enforcementMode
  </em>
  is different from the
  <em>
   disabled
  </em>
  effect. The
  <em>
   disabled
  </em>
  effect prevents resource evaluation from happening at all while
  <em>
   enforcementMode
  </em>
  lets the evaluation happen without the effect taking place.
 </p>
<p>
  The following table describes this property's values.
 </p>
<div class="has-inner-focus">
<table aria-label="Enforcement Mode" class="table">
<thead>
<tr>
<th style="text-align: left;">
      Mode
     </th>
<th style="text-align: left;">
      JSON value
     </th>
<th style="text-align: left;">
      Type
     </th>
<th style="text-align: left;">
      Remediate manually
     </th>
<th style="text-align: left;">
      Activity log entry
     </th>
<th style="text-align: left;">
      Description
     </th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">
      Enabled
     </td>
<td style="text-align: left;">
      Default
     </td>
<td style="text-align: left;">
      string
     </td>
<td style="text-align: left;">
      Yes
     </td>
<td style="text-align: left;">
      Yes
     </td>
<td style="text-align: left;">
      The policy effect is enforced during resource creation or update.
     </td>
</tr>
<tr>
<td style="text-align: left;">
      Disabled
     </td>
<td style="text-align: left;">
      DoNotEnforce
     </td>
<td style="text-align: left;">
      string
     </td>
<td style="text-align: left;">
      Yes
     </td>
<td style="text-align: left;">
      No
     </td>
<td style="text-align: left;">
      The policy effect isn't enforced during resource creation or update.
     </td>
</tr>
</tbody>
</table>
</div>
<p>
  If
  <em>
   enforcementMode
  </em>
  isn't specified in a policy or initiative definition, the value
  <em>
   Default
  </em>
  is used. Remediation tasks can be started for
  <em>
   deployIfNotExists
  </em>
  policies, even when
  <em>
   enforcementMode
  </em>
  is set to
  <em>
   DoNotEnforce
  </em>
  .
 </p>
<h2 id="policy-enforcement-and-safe-deployment-best-practices">
  Policy enforcement and safe deployment best practices
 </h2>
<p>
  Without the appropriate knowledge of best practices and proper testing, applying a set of policy to an existing environment that's running production workloads can result in unintended behaviors of policy resources. Treating policy as code (keeping your policy definitions in source control, and whenever a change is made, testing and validating that change) allows you to automate testing and make sure that no manual error factor happens. The best practices framework focuses on minimizing the impact of policy changes while ensuring compliance, and it includes two aspects:
 </p>
<ul>
<li>
<p>
<strong>
     First aspect
    </strong>
    - Start from Assignments of new policies with
    <em>
     enforcementMode
    </em>
    Disabled. When assigning policies that include deny or modify actions, beginning with
    <em>
     enforcementMode
    </em>
    Disabled allows you to view the compliance state and evaluate policy outcomes without triggering actions or denying operations. This "what-if" scenario minimizes impact and helps identify issues in the new policies or changes without disrupting the environment.
   </p>
</li>
<li>
<p>
<strong>
     Second aspect
    </strong>
    - Deploy policies in deployment rings. To control potential negative impacts, policies should be deployed gradually in smaller subsets and then in bigger sets. You can start with test and development environments and then move to production by applying the policy to a small subset first. This strategy helps in testing the policy thoroughly. Gradually expanding the scope (through deployment rings) can cover the full production environment.
   </p>
</li>
</ul>
<p>
  The following diagram shows how to apply the safe deployment best practices framework for Azure Policy assignments.
 </p>
<p>
  The following steps correspond with the outlined steps in the preceding screenshot:
 </p>
<ol>
<li>
<p>
<strong>
     Create definition
    </strong>
    - Begin by defining the policy definition with the scope as root (tenant).
   </p>
</li>
<li>
<p>
<strong>
     Create assignment
    </strong>
    - Define deployment rings (1 to 5) by using resource selectors. Assign the policy to a specific scope (such as a resource group, subscription, or management group) in Ring 5. Assign with
    <em>
     enforcementMode
    </em>
    Disabled to evaluate compliance without enforcing changes.
   </p>
</li>
<li>
<p>
    a)
    <strong>
     Compliance check
    </strong>
    - Verify that the policy is being applied correctly and that the desired compliance state is achieved for the resources in Ring 5.
   </p>
<p>
    b)
    <strong>
     Application health check
    </strong>
    - Assess the impact of the policy for the resources in Ring 5. Ensure that no unexpected side effects exist.
   </p>
</li>
<li>
<p>
<strong>
     Repeat for each ring (Non-production)
    </strong>
    - Repeat step 3 for all nonproduction environment rings.
   </p>
</li>
<li>
<p>
<strong>
     Update assignment (Optional)
    </strong>
    - If necessary, adjust the policy definition or assignment based on the evaluation of resources of the nonproduction environment and then reassign it to the resources in Ring 5 with the
    <em>
     enforcementMode
    </em>
    Enabled.
   </p>
</li>
<li>
<p>
    a)
    <strong>
     Compliance check
    </strong>
    - Reevaluate compliance after making changes (same as step 3a).
   </p>
<p>
    b)
    <strong>
     Application health check
    </strong>
    - Again, verify that the policy isn't causing issues (same as step 3b).
   </p>
</li>
<li>
<p>
<strong>
     Repeat for each ring (Non-production)
    </strong>
    - Repeat step 6 for all nonproduction environment rings.
   </p>
</li>
<li>
<p>
<strong>
     Repeat for production rings
    </strong>
    - After the policy is validated in a nonproduction environment, gradually deploy it to production environments, starting with a smaller subset (ring) and expanding the scope over time.
   </p>
</li>
</ol>
<p>
  For more detailed steps on the safe deployment of Azure Policy assignments with different effects, see
  <a data-linktype="absolute-path" href="/en-us/azure/governance/policy/how-to/policy-safe-deployment-practices#steps-for-safe-deployment-of-azure-policy-assignments-with-deny-or-append-effects">
   Safe deployment of Azure Policy assignments
  </a>
  .
 </p>
<h2 id="reacting-to-policy-state-changes">
  Reacting to policy state changes
 </h2>
<p>
  Azure Policy events allow applications to react to state changes. This integration is done without the need for complicated code or expensive and inefficient polling services. Events from Azure Policy (Event Source) are pushed through Microsoft Azure Event Grid to Event Handlers.
 </p>
<p>
  Azure Event Grid provides reliable delivery services to your applications through rich retry policies and dead-letter delivery. Event Grid takes care of the proper routing, filtering, and multicasting of the events to destinations through Event Grid subscriptions. For more information, see
  <a data-linktype="absolute-path" href="/en-us/azure/event-grid/">
   Azure Event Grid
  </a>
  .
 </p>
<p>
  An Event Handler is the place where the event is sent. Several services, such as Microsoft Azure Functions, Microsoft Azure Logic Apps, or your own custom HTTP listener, can be configured to handle events. You can also use any webhook for handling events.
 </p>
<p>
  For more information, see
  <a data-linktype="absolute-path" href="/en-us/azure/event-grid/event-handlers">
   Event handlers in Azure Event Grid
  </a>
  ,
  <a data-linktype="absolute-path" href="/en-us/azure/governance/policy/concepts/event-overview?tabs=event-grid-event-schema">
   Reacting to Azure Policy state change events
  </a>
  , and the
  <a data-linktype="absolute-path" href="/en-us/azure/governance/policy/tutorials/route-state-change-events">
   Route policy state change events to Event Grid with Azure CLI
  </a>
  tutorial.
 </p>
</div>
</div>
<div class="translation-placeholder">
<h2>ðŸ‡»ðŸ‡³ Vietnamese Translation</h2>
<p><em>Báº£n dá»‹ch tiáº¿ng Viá»‡t sáº½ Ä‘Æ°á»£c thÃªm vÃ o Ä‘Ã¢y...</em></p>
<p><em>Translation will be added here...</em></p>
</div>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exercise - Create an NVA and virtual machines - Training | Microsoft Learn</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            max-width: 900px;
            margin: 0 auto;
            padding: 30px 20px;
            color: #333;
            background-color: #fff;
        }
        
        h1, h2, h3, h4, h5, h6 {
            color: #0078d4;
            margin-top: 2em;
            margin-bottom: 1em;
            font-weight: 600;
        }
        
        h1 { 
            border-bottom: 3px solid #0078d4; 
            padding-bottom: 15px; 
            font-size: 2.2em;
            margin-bottom: 1.5em;
        }
        
        h2 { 
            font-size: 1.6em; 
            border-left: 4px solid #0078d4;
            padding-left: 15px;
        }
        
        h3 { font-size: 1.3em; }
        h4 { font-size: 1.1em; }
        
        p {
            margin: 16px 0;
            text-align: justify;
            line-height: 1.7;
        }
        
        ul, ol {
            margin: 20px 0;
            padding-left: 30px;
        }
        
        li {
            margin: 10px 0;
            line-height: 1.6;
        }
        
        code {
            background-color: #f6f8fa;
            padding: 3px 8px;
            border-radius: 4px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.9em;
            color: #d73a49;
        }
        
        pre {
            background-color: #f6f8fa;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            border-left: 4px solid #0078d4;
            margin: 20px 0;
        }
        
        pre code {
            background: none;
            padding: 0;
            color: #333;
        }
        
        blockquote {
            border-left: 4px solid #0078d4;
            padding: 20px;
            margin: 20px 0;
            background-color: #f8f9fa;
            border-radius: 4px;
            font-style: italic;
        }
        
        .source-info {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            border-left: 5px solid #2196f3;
            font-size: 0.9em;
        }
        
        .source-info h2 {
            margin-top: 0;
            color: #1976d2;
            font-size: 1.2em;
        }
        
        .translation-placeholder {
            background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
            padding: 20px;
            border-radius: 8px;
            margin-top: 40px;
            border-left: 5px solid #ff9800;
        }
        
        .translation-placeholder h2 {
            margin-top: 0;
            color: #f57c00;
            font-size: 1.2em;
        }
        
        img { 
            max-width: 100%; 
            height: auto; 
            margin: 25px 0;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        table { 
            border-collapse: collapse; 
            width: 100%; 
            margin: 25px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        th, td { 
            border: 1px solid #ddd; 
            padding: 15px; 
            text-align: left; 
        }
        
        th { 
            background-color: #f5f5f5; 
            font-weight: bold;
            color: #0078d4;
        }
        
        .highlight {
            background-color: #fff3cd;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #ffc107;
            margin: 20px 0;
        }
        
        strong {
            color: #0078d4;
            font-weight: 600;
        }
        
        a {
            color: #0078d4;
            text-decoration: none;
        }
        
        a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="source-info">
        <h2>ðŸ“š Course Information</h2>
        <p><strong>Unit:</strong> Exercise - Create an NVA and virtual machines</p>
        <p><strong>Source:</strong> <a href="https://learn.microsoft.com/en-us/training/modules/control-network-traffic-flow-with-routes/5-exercise-create-nva-vm/?ns-enrollment-type=learningpath&ns-enrollment-id=learn.az-104-manage-virtual-networks" target="_blank">Microsoft Learn</a></p>
        <p><strong>Course:</strong> AZ-104: Microsoft Azure Administrator</p>
    </div>
    
    <div class="main-content">
        <div aria-hidden="false" id="module-unit-content">
 <p>
  In the next stage of your security implementation, you'll deploy a network virtual appliance (NVA) to secure and monitor traffic between your front-end public servers and internal private servers.
 </p>
 <p>
  First, configure the appliance to forward IP traffic. If IP forwarding isn't enabled, traffic that is routed through your appliance will never be received by its intended destination servers.
 </p>
 <p>
  In this exercise, you deploy the
  <strong>
   nva
  </strong>
  network appliance to the
  <strong>
   dmzsubnet
  </strong>
  subnet. Then you enable IP forwarding so that traffic from
  <strong>
   <code>
    *
   </code>
  </strong>
  and traffic that uses the custom route is sent to the
  <strong>
   privatesubnet
  </strong>
  subnet.
 </p>
 <p>
  In the following steps, you'll deploy an NVA. You'll then update the Azure virtual NIC and the network settings within the appliance to enable IP forwarding.
 </p>
 <h2 id="deploy-the-network-virtual-appliance">
  Deploy the network virtual appliance
 </h2>
 <p>
  To build the NVA, deploy an Ubuntu LTS instance.
 </p>
 <ol>
  <li>
   <p>
    In Cloud Shell, run the following command to deploy the appliance. Replace
    <code>
     &lt;password&gt;
    </code>
    with a suitable password of your choice for the
    <strong>
     azureuser
    </strong>
    admin account.
   </p>
   <pre class="has-inner-focus"><code class="lang-azurecli" data-author-content='az vm create \
    --resource-group "&lt;rgn&gt;[sandbox resource group name]&lt;/rgn&gt;" \
    --name nva \
    --vnet-name vnet \
    --subnet dmzsubnet \
    --image Ubuntu2204 \
    --admin-username azureuser \
    --admin-password &lt;password&gt;
'><span><span class="hljs-keyword">az vm create </span>\
    <span class="hljs-parameter">--resource-group</span> <span class="hljs-string">"[sandbox resource group name]"</span> \
    <span class="hljs-parameter">--name</span> nva \
    <span class="hljs-parameter">--vnet-name</span> vnet \
    <span class="hljs-parameter">--subnet</span> dmzsubnet \
    <span class="hljs-parameter">--image</span> Ubuntu2204 \
    <span class="hljs-parameter">--admin-username</span> azureuser \
    <span class="hljs-parameter">--admin-password</span> <span class="hljs-string">&lt;password&gt;</span>
</span></code></pre>
  </li>
 </ol>
 <h2 id="enable-ip-forwarding-for-the-azure-network-interface">
  Enable IP forwarding for the Azure network interface
 </h2>
 <p>
  In the next steps, you enable IP forwarding for the
  <strong>
   nva
  </strong>
  network appliance. When traffic flows to the NVA but is meant for another target, the NVA will route that traffic to its correct destination.
 </p>
 <ol>
  <li>
   <p>
    Run the following command to get the NVA network interface's ID:
   </p>
   <pre class="has-inner-focus"><code class="lang-azurecli" data-author-content='NICID=$(az vm nic list \
    --resource-group "&lt;rgn&gt;[sandbox resource group name]&lt;/rgn&gt;" \
    --vm-name nva \
    --query "[].{id:id}" --output tsv)

echo $NICID
'><span>NICID=$(az vm nic list \
    <span class="hljs-parameter">--resource-group</span> <span class="hljs-string">"[sandbox resource group name]"</span> \
    <span class="hljs-parameter">--vm-name</span> nva \
    <span class="hljs-parameter">--query</span> <span class="hljs-string">"[].{id:id}"</span> <span class="hljs-parameter">--output</span> tsv)

echo <span class="hljs-variable">$NICID</span>
</span></code></pre>
  </li>
  <li>
   <p>
    Run the following command to get the NVA network interface's name:
   </p>
   <pre class="has-inner-focus"><code class="lang-azurecli" data-author-content='NICNAME=$(az vm nic show \
    --resource-group "&lt;rgn&gt;[sandbox resource group name]&lt;/rgn&gt;" \
    --vm-name nva \
    --nic $NICID \
    --query "{name:name}" --output tsv)

echo $NICNAME
'><span>NICNAME=$(az vm nic show \
    <span class="hljs-parameter">--resource-group</span> <span class="hljs-string">"[sandbox resource group name]"</span> \
    <span class="hljs-parameter">--vm-name</span> nva \
    <span class="hljs-parameter">--nic</span> <span class="hljs-variable">$NICID</span> \
    <span class="hljs-parameter">--query</span> <span class="hljs-string">"{name:name}"</span> <span class="hljs-parameter">--output</span> tsv)

echo <span class="hljs-variable">$NICNAME</span>
</span></code></pre>
  </li>
  <li>
   <p>
    Run the following command to enable IP forwarding for the network interface:
   </p>
   <pre class="has-inner-focus"><code class="lang-azurecli" data-author-content='az network nic update --name $NICNAME \
    --resource-group "&lt;rgn&gt;[sandbox resource group name]&lt;/rgn&gt;" \
    --ip-forwarding true
'><span><span class="hljs-keyword">az network nic update </span><span class="hljs-parameter">--name</span> <span class="hljs-variable">$NICNAME</span> \
    <span class="hljs-parameter">--resource-group</span> <span class="hljs-string">"[sandbox resource group name]"</span> \
    <span class="hljs-parameter">--ip-forwarding</span> <span class="hljs-literal">true</span>
</span></code></pre>
  </li>
 </ol>
 <h2 id="enable-ip-forwarding-in-the-appliance">
  Enable IP forwarding in the appliance
 </h2>
 <ol>
  <li>
   <p>
    Run the following command to save the NVA virtual machine's public IP address to the variable
    <code>
     NVAIP
    </code>
    :
   </p>
   <pre aria-label="Horizontally scrollable code" class="has-inner-focus" role="group" tabindex="0"><code class="lang-azurecli" data-author-content='NVAIP="$(az vm list-ip-addresses \
    --resource-group "&lt;rgn&gt;[sandbox resource group name]&lt;/rgn&gt;" \
    --name nva \
    --query "[].virtualMachine.network.publicIpAddresses[*].ipAddress" \
    --output tsv)"

echo $NVAIP
'><span>NVAIP=<span class="hljs-string">"<span class="hljs-variable">$(az vm list-ip-addresses \
    --resource-group "[sandbox resource group name]" \
    --name nva \
    --query "[].virtualMachine.network.publicIpAddresses[*].ipAddress" \
    --output tsv)</span>"</span>

echo <span class="hljs-variable">$NVAIP</span>
</span></code></pre>
  </li>
  <li>
   <p>
    Run the following command to enable IP forwarding within the NVA:
   </p>
   <pre aria-label="Horizontally scrollable code" class="has-inner-focus" role="group" tabindex="0"><code class="lang-bash" data-author-content="ssh -t -o StrictHostKeyChecking=no azureuser@$NVAIP 'sudo sysctl -w net.ipv4.ip_forward=1; exit;'
"><span>ssh -t -o StrictHostKeyChecking=no azureuser@<span class="hljs-variable">$NVAIP</span> <span class="hljs-string">'sudo sysctl -w net.ipv4.ip_forward=1; exit;'</span>
</span></code></pre>
   <p>
    When prompted, enter the password you used when you created the virtual machine.
   </p>
  </li>
 </ol>
</div>

    </div>
    
    <div class="translation-placeholder">
        <h2>ðŸ‡»ðŸ‡³ Vietnamese Translation</h2>
        <p><em>Báº£n dá»‹ch tiáº¿ng Viá»‡t sáº½ Ä‘Æ°á»£c thÃªm vÃ o Ä‘Ã¢y...</em></p>
        <p><em>Translation will be added here...</em></p>
    </div>
</body>
</html>